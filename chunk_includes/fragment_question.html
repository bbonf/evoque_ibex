<script>
selector = document.getElementById("fragment_selector");
selector_fromidx = text_thusfar.length;

radio_buttons_yesno = [];
radio_buttons_5 = [];

init();

function revealForm() {

    document.getElementById("form").style.visibility = "visible";

}


function quality_check() {

    var check = true;

    document.getElementById("question_error").style.visibility = "hidden";
    document.getElementById("question_highlighting_error").style.visibility = "hidden";
    document.getElementById("div_for_first_error_message").style.visibility = "hidden";

    // The question field
    // TODO More sophisticated quality control, e.g., spellcheck, min length, question mark?
    if ( document.getElementById("question").value == "" ) {
        flashMessage(document.getElementById("question_error"));
        check = false;
    }

    // The highlighting
    // TODO More sophisticated quality control, e.g., min words, max words?
    if ( document.getElementById("selection_text").value == ""
        ) {
        flashMessage(document.getElementById("question_highlighting_error"));
        check = false;
    }

    if (!check) flashMessage(document.getElementById("div_for_first_error_message"));

    // If all is fine
    if (check) {

        // Save some results for next screen
        if (document.getElementById("question").value != "") {
            window.questions_thusfar.push(document.getElementById("question").value);
            window.highlights_thusfar.push([document.getElementById("selection_start").value, document.getElementById("selection_end").value]);
        }

        // Slowly scroll to top
        $("html, body").animate({ scrollTop: 0 }, "slow");
    }

    return check;

}

</script>


<!--
<center><button onclick="clearSelection()">clear highlighting</button></center> -->

<div style="width: 40em">
    <hr>
        <div style="height: 120pt">  <!-- TODO More principled way of choosing height -->
            <div id="fragment_highlighter_prev" style="color:transparent; position: absolute; width: 40em; display: inline-block"></div>
            <div id="fragment_highlighter" style="color:transparent; position: absolute; width: 40em; display: inline-block"></div>
            <div id="fragment_colorizer" style="position: absolute; width: 40em; display: inline-block"></div>
            <div id="fragment_selector" style="color:transparent; position: relative; width: 40em; display: inline-block"></div>
        </div>
    <hr>

<div id="form" style="visibility: hidden; width:40em">

    <p>
        <b>&#9654; Enter a question you feel is evoked by the text at this point.</b><br>
        <!-- (List up to three questions; leave <i>blank</i> if it does not evoke any questions.) <br> -->
        <div class="r-pill__group"><input name="question" id="question" type="text" style="width: 25em; color:#083851; border-style:none" /></div><b id="question_error" style="color: red; visibility: hidden;"> *</b>
    </p>

    <p>
        <b>&#9654; In the text, <mark id="marker_in_question" style="background:#76bef8">highlight</mark> the main phrase that evoked this question.</b>
        <b id="question_highlighting_error" style="color: red; visibility: hidden"> *</b>
        <!-- <ul>
            <li>Please  a phrase in the fragment above (cursor selection).</li>
            <li>To change the highlighting just make a new selection.</li>
            <li>There's also a button to <i>clear</i> the current highlighting.</li>
            <li>If no phrase seems suitable for marking, do not select anything.</li>
        </ul>-->
<!-- below are invisible form fields to which the selection is saved. -->
        <div style="display: none">
        Selected text:
            <input id="selection_text" name="question_highlighting" type="text" style="width: 32em">
            <textarea id="selection_start" name="question_highlighting_start" rows="1" cols="10"></textarea>
            <textarea id="selection_end" name="question_highlighting_end" rows="1" cols="10"></textarea>
        </div>
    </p>

    <hr>

    <div id="div_for_first_error_message" style="color: red; visibility: hidden">
        Please complete the form first.
    </div>
</div>
</div>